cs(aidsdb_no$aids,aidsdb_no$ccr5)
knitr::include_graphics("notrack/epi-03.png")
knitr::include_graphics("notrack/epi-04.png")
knitr::include_graphics("notrack/epi-05.png")
knitr::include_graphics("notrack/epi-06.png")
coxdb <- read_dta("data/aidsdb.dta") %>% as_factor() %>%
mutate(aids=as.integer(aids)-1)
coxdb %>% glimpse()
fit <- survfit(Surv(ttoaidsorexit, aids) ~ ccr5, data =  coxdb)
#summary(fit)
fit %>% broom::tidy() #revisa el estrato!
#(1-(1/84)) * (1-(1/81))
# Visualize with survminer
ggsurvplot(fit, data = coxdb, risk.table = TRUE,
conf.int = T,ggtheme = theme_bw(),#ggtheme = theme_minimal(),
pval = T,censor=FALSE,tables.theme = theme_cleantable())
survdiff(Surv(ttoaidsorexit, aids) ~ ccr5, data =  coxdb)
knitr::include_graphics("notrack/ggdag-epistat2019.png")
knitr::include_graphics("notrack/nmeth.3904-F3_A.jpg")
aidsdb_or %>% glimpse()
aidsdb_or_no
glm(aids ~ ccr5 + race, data = aidsdb_or_no, family = binomial(link = "logit"))
coxdb %>% glimpse()
fit <- survfit(Surv(ttoaidsorexit, aids) ~ ccr5, data =  coxdb)
#summary(fit)
fit %>% broom::tidy() #revisa el estrato!
coxdb
#summary(fit)
fit %>% broom::tidy() #revisa el estrato!
# Visualize with survminer
ggsurvplot(fit, data = coxdb, risk.table = TRUE,
conf.int = T,ggtheme = theme_bw(),#ggtheme = theme_minimal(),
pval = T,censor=FALSE,tables.theme = theme_cleantable())
coxdb
fit
coxdb
women
library(tidyverse)     #limpiar base de datos: http://r4ds.had.co.nz/
library(broom)         #limpiar output de modelos
library(haven)         #importar diferentes formatos
library(readxl)        #importar excel files
library(ggdag)         #crear DAGs y conjuntos de ajuste: https://ggdag.netlify.com/
library(compareGroups) #generar tabla 1 y 2
library(epiR)          #generar tablas epidemiológicas
library(epiDisplay)    #generar tablas epidemiológicas
library(knitr)         #generar formato de tabla
library(kableExtra)    #generar formato extra de tabla
library(survival)      #analizar datos tiempo a evento
library(survminer)     #visualizar datos tiempo a evento
set.seed(33)
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning=FALSE, error=FALSE)
theme_set(theme_bw())
options(width = 120)
data_frame(p=seq(0,1,0.01)) %>%
mutate(odd=p/(1-p)) %>%
ggplot(aes(p,log(odd))) +
geom_point() +
coord_flip()
data_frame(p=seq(0,1,0.01)) %>%
mutate(odd=p/(1-p),
logit=log(odd))
data_frame(p=seq(0,1,0.01)) %>%
mutate(odd=p/(1-p),
logit=log(odd)) %>%
pivot_longer(cols = -p,names_to = "key",values_to = "value")
data_frame(p=seq(0,1,0.01)) %>%
mutate(odd=p/(1-p),
logit=log(odd)) %>%
pivot_longer(cols = -p,names_to = "key",values_to = "value") %>%
ggplot(aes(p,value)) +
geom_point() +
facet_wrap(~key)
data_frame(p=seq(0,1,0.01)) %>%
mutate(odd=p/(1-p),
logit=log(odd)) %>%
pivot_longer(cols = -p,names_to = "key",values_to = "value") %>%
ggplot(aes(p,value)) +
geom_point() +
facet_wrap(~key,scales = "free")
data_frame(p=seq(0,1,0.01)) %>%
mutate(odd=p/(1-p),
logit=log(odd)) %>%
pivot_longer(cols = -p,names_to = "key",values_to = "value") %>%
ggplot(aes(p,value)) +
geom_point() +
facet_wrap(~key,scales = "free") +
coord_flip()
data_frame(p=seq(0,1,0.01)) %>%
mutate(odd=p/(1-p),
logit=log(odd)) %>%
pivot_longer(cols = -p,names_to = "key",values_to = "value") %>%
mutate(key=fct_rev(key)) %>%
ggplot(aes(p,value)) +
geom_point() +
facet_wrap(~key,scales = "free") +
coord_flip()
library(tidyverse)
library(broom)
library(haven)
library(ggdag)
library(compareGroups)
library(knitr)
library(kableExtra)
library(survival)
library(survminer)
library(epiR)
set.seed(33)
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning=FALSE, error=FALSE)
theme_set(theme_bw())
knitr::include_graphics("notrack/nmeth.3627-F1.jpg")
women %>% ggplot(aes(weight,height)) + geom_point() + geom_smooth(method = "lm")
espir <- read_dta("data-raw/espirometria.dta") %>% as_factor()
espir
espir %>%
ggplot(aes(edad,vef)) +
geom_point()
knitr::include_graphics("notrack/Inkedlss01_LI.jpg")
knitr::include_graphics("notrack/Inkedlss02_LI.jpg")
knitr::include_graphics("notrack/lss.png")
wm1 <- lm(vef ~ edad, data = espir)
wm1 %>% glance() %>% dplyr::select(r.squared:df)
wm1 %>% tidy()
wm1 %>% confint_tidy()
knitr::include_graphics("notrack/Inkedlss2_LI.jpg")
knitr::include_graphics("notrack/nmeth.3854-F2.jpg")
wm1 %>%
augment() %>%
ggplot() +
geom_qq(aes(sample=.std.resid)) +
geom_qq_line(aes(sample=.std.resid))
wm1 %>% augment() %>%
ggplot(aes(.std.resid)) +
geom_histogram()
knitr::include_graphics("notrack/nmeth.3854-F1.jpg")
wm1 %>%
augment() %>%
ggplot(aes(.fitted,.std.resid)) +
geom_point() +
geom_smooth() +
geom_hline(yintercept = c(0))
espir %>%
ggplot(aes(edad,vef)) +
geom_point() +
geom_smooth(method = "lm")
compareGroups(fumar ~ edad + vef + talla + sexo,
data = espir, byrow=T#,method=c(vef=2)
) %>%
createTable(show.all = T) #%>% export2xls("table/tab1.xls")
espir %>%
dplyr::select(edad,vef,talla) %>%
gather(key,value) %>%
ggplot(aes(value)) +
geom_histogram() +
facet_wrap(~key,scales = "free")
epi_summary <- function(df, x) {
x_var <- enquo(x)
df %>%
summarise(n_obs=n(),
min=min(!!x_var,na.rm = T),
max=max(!!x_var,na.rm = T),
mean=mean(!!x_var,na.rm = T) %>% signif(.,
digits = str_length(str_replace(.,"(.+)\\.(.+)","\\1")) + 2),
sd=sd(!!x_var,na.rm = T),
q25=quantile(!!x_var,probs = 0.25,na.rm = T),
q50=median(!!x_var,na.rm = T),
q75=quantile(!!x_var,probs = 0.75,na.rm = T),
skewness=moments::skewness(!!x_var,na.rm = T),
kurtosis=moments::kurtosis(!!x_var,na.rm = T)
) #%>%
#mutate(var=enquo(x)) %>%
#dplyr::select(var,everything())
}
epi_summary(espir,vef)
knitr::include_graphics("notrack/ggdag-epistat2019.png")
espir %>%
ggplot(aes(edad,vef,colour=sexo)) +
geom_point()
wm1 <- lm(vef ~ edad + sexo, data = espir)
wm1 %>% glance() %>% dplyr::select(r.squared:df)
m1 <- wm1 %>% tidy() %>% rownames_to_column()
m2 <- wm1 %>% confint_tidy() %>% rownames_to_column()
left_join(m1, m2) %>% dplyr::select(-rowname)
wm1 %>%
augment() %>%
ggplot() +
geom_qq(aes(sample=.std.resid)) +
geom_qq_line(aes(sample=.std.resid))
wm1 %>%
augment() %>%
ggplot(aes(.fitted,.std.resid)) +
geom_point() +
geom_smooth() +
geom_hline(yintercept = c(0))
wm1 %>% augment() %>%
ggplot(aes(colour= sexo)) +
geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5)
ggsave("notrack/multi-01.png")
#identificar coeficientes y R^2^
# recordar: y ~ x
#wm1 <- lm(vef ~ edad*fumar + sexo, data = espir)
wm1 <- lm(vef ~ edad*sexo, data = espir)
#wm1 %>% glance()
m1 <- wm1 %>% tidy() %>% rownames_to_column()
m2 <- wm1 %>% confint_tidy() %>% rownames_to_column()
left_join(m1, m2) %>% dplyr::select(term,estimate,conf.low,conf.high#,p.value
)
wm1 %>% augment() %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=sexo)) +
geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5)
ggsave("notrack/multi-02.png")
#identificar coeficientes y R^2^
# recordar: y ~ x
#wm1 <- lm(vef ~ edad*fumar + sexo, data = espir)
wm1 <- lm(vef ~ edad*fumar, data = espir)
#wm1 %>% glance()
m1 <- wm1 %>% tidy() %>% rownames_to_column()
m2 <- wm1 %>% confint_tidy() %>% rownames_to_column()
left_join(m1, m2) %>% dplyr::select(term,estimate,conf.low,conf.high#,p.value
)
wm1 %>% augment() %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5)
wm1 %>% augment() %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5)
wm1 %>% augment() %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5)
wm1 %>% augment() %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="",y="")
wm1 %>% augment() %>%
filter(edad>8) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="",y="")
wm1 %>% augment() %>%
filter(edad>6) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="",y="")
wm1 %>% augment() %>%
filter(edad>6) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="",y="",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
scale_color_manual(NULL) +
labs(x="",y="",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
scale_color_manual("") +
labs(x="",y="",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
scale_color_manual("none") +
labs(x="",y="",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="",y="",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(fumar=fct_recode(fumar,"1"="No","2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="",y="",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(fumar=fct_recode(fumar,"1"="No","2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="tiempo",y="log(incidencia)",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=exp(edad)) %>%
mutate(fumar=fct_recode(fumar,"1"="No","2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="tiempo",y="log(incidencia)",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(fumar=fct_recode(fumar,"1"="No","2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="tiempo",y="log(incidencia)",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(fumar=fct_recode(fumar,"1"="No","2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="tiempo",y="incidencia",color="")
ggsave("notrack/0-dynamics.png",width = 4,height = 5)
ggsave("notrack/0-dynamics.png",width = 4,height = 3,dpi = "retina")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(.fitted=(.fitted*100)-200) %>%
mutate(fumar=fct_recode(fumar,
"1"="No",
"2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="tiempo",y="incidencia",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad))
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad))
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(.fitted=(.fitted*100)-200)
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(.fitted=(.fitted*100)-200) %>%
mutate(fumar=fct_recode(fumar,
"1"="No",
"2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5)
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(.fitted=(.fitted*100)-200)
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(.fitted=(.fitted*100))
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(edad=(edad*100)-200) %>%
mutate(fumar=fct_recode(fumar,
"1"="No",
"2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="tiempo",y="incidencia",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(edad=((edad*100)-200)/5) %>%
mutate(fumar=fct_recode(fumar,
"1"="No",
"2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="tiempo",y="incidencia",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(edad=((edad*100)-200)/(5*3)) %>%
mutate(fumar=fct_recode(fumar,
"1"="No",
"2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="tiempo",y="incidencia",color="")
wm1 %>% augment() %>%
filter(edad>6) %>%
mutate(edad=log(edad)) %>%
mutate(edad=((edad*100)-200)/(5*3)) %>%
mutate(fumar=fct_recode(fumar,
"1"="No",
"2"="Si")) %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
# geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5) +
labs(x="tiempo",y="incidencia",color="") +
scale_x_continuous(breaks = scales::pretty_breaks(n = 8))
ggsave("notrack/0-dynamics.png",width = 4,height = 3,dpi = "retina")
library(tidyverse)
library(tidyverse)
library(broom)
library(haven)
library(ggdag)
library(compareGroups)
library(knitr)
library(kableExtra)
library(survival)
library(survminer)
library(epiR)
set.seed(33)
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning=FALSE, error=FALSE)
theme_set(theme_bw())
espir <- read_dta("data-raw/espirometria.dta") %>% as_factor()
espir %>%
ggplot(aes(edad,vef)) +
geom_point() +
geom_smooth(method = "lm")
ggsave("notrack/multi-00.png")
knitr::include_graphics("notrack/multi-02.png")
espir
wm1 <- lm(vef ~ edad*fumar, data = espir)
wm1
#wm1 %>% glance()
m1 <- wm1 %>% tidy() %>% rownames_to_column()
m2 <- wm1 %>% confint_tidy() %>% rownames_to_column()
left_join(m1, m2) %>% dplyr::select(term,estimate,conf.low,conf.high#,p.value
)
wm1 %>% augment()
wm1 %>% augment() %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar))
wm1 %>% augment() %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5)
wm1 %>% augment() %>%
#mutate(inter=str_c(fumar,":",sexo) %>% as.factor()) %>%
#ggplot(aes(colour=inter)) +
ggplot(aes(colour=fumar)) +
geom_point(aes(edad,vef),alpha=0.05) +
geom_line(aes(edad,.fitted), lwd=1.5)
ggsave("notrack/multi-03.png")
ggsave("notrack/multi-03.png")
#identificar coeficientes y R^2^
# recordar: y ~ x
#wm1 <- lm(vef ~ edad*fumar + sexo, data = espir)
wm1 <- lm(vef ~ edad*sexo, data = espir)
#wm1 %>% glance()
m1 <- wm1 %>% tidy() %>% rownames_to_column()
m2 <- wm1 %>% confint_tidy() %>% rownames_to_column()
left_join(m1, m2) %>% dplyr::select(term,estimate,conf.low,conf.high#,p.value
)
usethis::use_readme_rmd()
